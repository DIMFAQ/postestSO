<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POSTEST JUDUL 3 PRAKTIKUM SISTEM OPERASI</title>
  <style>
    :root{
      --bg:#071024;
      --card:#071427;
      --accent:#60a5fa;
      --muted:#93c5fd33;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --gap:12px;
      --text:#e6eef8;
      --muted-text:#9fbdf4;
      --max-read-width:760px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071023 0%, #041022 85%); color:var(--text); -webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:0;padding:9px 12px;border-radius:10px;color:#04243a;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);padding:7px 10px;border-radius:10px}
    button[disabled]{opacity:0.45;cursor:not-allowed}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:var(--gap);margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);min-height:120px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;transition:transform .12s}
    .card:hover{transform:translateY(-6px)}
    .card h3{margin:0 0 8px 0;font-size:15px}
    .card p{margin:0;font-size:13px;color:#bcd5efcc;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .tag{font-size:12px;padding:6px 8px;border-radius:999px;background:var(--glass);display:inline-block;margin-right:6px}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .selected{outline:3px solid rgba(96,165,250,0.14);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .card-timer{background:rgba(96,165,250,0.12);color:var(--accent);padding:6px 8px;border-radius:999px;font-weight:700;font-size:13px;min-width:64px;text-align:center;margin-left:8px}
    .modalWrap{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(rgba(2,6,23,0.6), rgba(2,6,23,0.6));backdrop-filter: blur(6px);padding:20px;z-index:50}
    .modal{max-width:920px;width:100%;background:linear-gradient(180deg, #071124, #041023);border-radius:10px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    .steps{margin-top:10px;background:rgba(255,255,255,0.02);padding:14px;border-radius:8px;max-height:64vh;overflow:auto}
    .permTable{margin-top:10px;border-radius:8px;padding:10px;background:rgba(255,255,255,0.02)}
    .permRow{display:flex;justify-content:space-between;padding:8px 6px;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .permRow:last-child{border-bottom:0}
    .copyModalContent{display:flex;flex-direction:column;gap:8px}
    textarea.copyArea{width:100%;min-height:160px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .overlayFull{position:fixed;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.95),rgba(2,6,23,0.98));color:white;display:none;z-index:100;align-items:center;justify-content:center;padding:28px}
    .overlayCard{max-width:1100px;width:100%;background:linear-gradient(180deg,#071124,#041023);border-radius:12px;padding:26px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(2,6,23,0.7);text-align:left;color:#e6eef8;display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
    .overlayLeft{padding-right:8px; max-width: var(--max-read-width);}
    .overlayRight{background:rgba(255,255,255,0.02);padding:16px;border-radius:10px;text-align:center;min-height:160px}
    .overlayCard h2{margin:0 0 6px 0;font-size:20px}
    .overlayCard p.lead{color:#cfe7ffcc;margin:8px 0 14px;font-size:14px;line-height:1.4}
    .bigTimer{font-size:36px;font-weight:800;margin:8px 0;color:var(--accent)}
    .progressBar{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;margin-top:8px}
    .progressFill{height:100%;width:0%;background:linear-gradient(90deg,rgba(96,165,250,0.9),rgba(96,165,250,0.6));transition:width 0.4s linear}
    .overlayControls{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .overlayControls button{width:100%}
    .mutedSmall{font-size:13px;color:#9fbdf4}
    .descriptionBlock{max-width:100%}
    /* formatted lists */
    .desc-ul{margin:8px 0 8px 20px}
    .desc-ol-alpha{margin:6px 0 6px 28px; list-style-type: lower-alpha;}
    .desc-par{margin:8px 0;color:#d8eefd;white-space:pre-wrap}
    @media (max-width:1100px){ .overlayCard{grid-template-columns:1fr 320px} }
    @media (max-width:900px){ .overlayCard{grid-template-columns:1fr} .overlayRight{order:2} .overlayLeft{max-width:100%} }
    @media (max-width:520px){ .bigTimer{font-size:28px} .card p{white-space:normal} }
    
    /* Efek animasi goyang/putar tombol (dari langkah sebelumnya, dipertahankan) */
    @keyframes roll-gacha {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-2px, -2px) rotate(-5deg); }
      50% { transform: translate(2px, 2px) rotate(5deg); }
      75% { transform: translate(-2px, -2px) rotate(-5deg); }
      100% { transform: translate(0, 0) rotate(0deg); }
    }

    button#gachaBtn.is-rolling {
      animation: roll-gacha 0.15s infinite;
      opacity: 0.85;
      cursor: wait;
    }

    /* Efek animasi putar untuk spinner (BARU) */
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Class untuk mengaktifkan putaran */
    .is-spinning {
        animation-name: spin;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>POSTEST JUDUL 3 PRAKTIKUM SISTEM OPERASI</h1>
        <div style="color:#9fbdf4;font-size:13px;margin-top:6px">Klik "GACHA" untuk mendapatkan study case acak. Klik kartu untuk lihat detail.</div>
      </div>
      <div class="controls" role="toolbar" aria-label="kontrol">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="gachaBtn" type="button">üé≤ GACHA</button>
          <span id="gachaTimer" style="font-size:13px;color:#9fbdf4;min-width:80px;text-align:center"></span>
        </div>
        <button class="secondary" id="openPermGuide" type="button">Panduan Semua</button>
      </div>
    </header>

    <main>
      <div class="grid" id="grid" role="list"></div>
      <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
        <div style="font-size:13px;color:#9fbdf4">Dipilih:</div>
        <div id="pickedLabel" style="font-weight:700;color:var(--accent)">Tidak ada</div>
      </div>
    </main>
  </div>

  <div class="modalWrap" id="modal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <h3 id="modalTitle">Judul</h3>
        <div style="display:flex;gap:8px">
          <button id="closeModal" type="button">Tutup</button>
        </div>
      </div>
      <div class="steps" id="modalSteps"></div>
      <div class="permTable" id="modalPerms"></div>
    </div>
  </div>

  <div class="modalWrap" id="permGuide" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Daftar Semua Study Case</h3>
        <div>
          <button id="closeGuide" type="button">Tutup</button>
        </div>
      </div>
      <div class="steps" style="max-height:60vh;overflow:auto">
        <div id="guideContent" style="margin-top:8px;white-space:pre-wrap"></div>
      </div>
    </div>
  </div>

  <div class="modalWrap" id="copyModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><button id="closeCopy" type="button">Tutup</button></div>
      </div>
      <div class="steps copyModalContent">
        <div style="font-size:13px;color:#9fbdf4">Jika clipboard diblokir, salin teks di bawah secara manual (Ctrl/Cmd + C)</div>
        <textarea class="copyArea" id="copyArea" readonly></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end"><button id="selectAll" type="button">Pilih Semua</button></div>
      </div>
    </div>
  </div>

  <div class="overlayFull" id="postGachaOverlay" aria-hidden="true">
    <div class="overlayCard" role="dialog" aria-modal="true" aria-labelledby="overlayTitle">
      <div class="overlayLeft">
        <h2 id="overlayTitle">Study Case</h2>
        <p class="lead" id="overlaySubtitle">Ringkasan study case yang kamu dapatkan.</p>

        <div class="descriptionBlock" id="overlaySummary" aria-live="polite"></div>

        <div style="margin-top:12px">
          <strong>Potongan penting (jika ada):</strong>
          <div id="overlayPermsShort" style="margin-top:8px"></div>
        </div>

      </div>

      <div class="overlayRight">
        <div id="gachaSpinner" style="display:none; margin: 30px 0; font-size: 80px; transform-origin: center; animation-duration: 0.1s;">üé≤</div>
        <div class="mutedSmall">Sisa waktu</div>
        <div id="overlayTimerBig" class="bigTimer">--:--</div>
        <div class="progressBar"><div id="overlayProgress" class="progressFill" style="width:0%"></div></div>

        <div class="overlayControls">
          <button id="startGachaLock" class="bigBtn" style="background:var(--accent);color:#04243a">MULAI</button>
          <button id="hideOverlay" class="secondary">Sembunyikan (tetap jalan)</button>
          <button id="stopTimer" class="secondary" style="display:none">Berhenti (batalkan)</button>
        </div>

        <div style="margin-top:8px" class="mutedSmall">Timer aktif setelah menekan MULAI. Sembunyikan untuk melihat dashboard ‚Äî timer tetap berjalan.</div>
      </div>
    </div>
  </div>

  <script>
    // SETTINGS
    const GACHA_COOLDOWN_MINUTES = 20;
    const GACHA_ANIMATION_DURATION_MS = 2000; // Durasi animasi (2 detik)
    const STORAGE_KEY = 'lastGachaData_allcases_v2';

    // STUDY CASES (sudah ada, trimmed for brevity in code area but kept full above)
const studyCases = [
`Kasus:
Seorang administrator sistem diminta menyiapkan direktori kerja dan setup akses untuk proyek pengembangan aplikasi web. Dalam proyek ini dibutuhkan:
‚óè Direktori utama WebApp yang berisi 3 subdirektori: src, config, logs.
‚óè Tiga grup kolaborasi: Dev, Ops, Sec.
‚óè Enam pengguna: dev1, dev2, ops1, ops2, sec1, sec2.
‚óè Di dalam src dibuat tiga file (app.js, routes.txt, run.sh):
a. app.js ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. routes.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. run.sh ‚Üí pemilik: read, write, execute; grup: read, execute; selainnya: read.
‚óè Salah satu user dari grup Ops (ops1) diatur agar masa berlaku password-nya berakhir setelah 14 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk ops1.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori kerja untuk project analisis data. Dalam proyek ini dibutuhkan:
‚óè Direktori utama DataLab yang berisi 3 subdirektori: raw, scripts, reports.
‚óè Tiga grup: Ingest, Analyst, Report.
‚óè Enam pengguna: ingest1, ingest2, analyst1, analyst2, report1, report2.
‚óè Di dalam scripts dibuat file (etl.py, analyze.sh, debug.log):
a. etl.py ‚Üí pemilik: read, write, execute; grup: read, execute; selainnya: tidak ada akses.
b. analyze.sh ‚Üí pemilik: read, write, execute; grup: read; selainnya: tidak ada akses.
c. debug.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu user dari grup Analyst (analyst2) diatur masa berlaku password 20 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk analyst2.`,

`Kasus:
Seorang admin diperlukan men-setup lingkungan development mobile. Dalam proyek ini dibutuhkan:
‚óè Direktori utama MobileDev yang berisi 3 subdirektori: sdk, project, build.
‚óè Tiga grup: AndroidTeam, iOSTeam, QA.
‚óè Enam pengguna: and1, and2, ios1, ios2, qa1, qa2.
‚óè Di dalam project dibuat file (build.gradle, app.apk, notes.md):
a. build.gradle ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. app.apk ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. notes.md ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu user AndroidTeam (and1) diberi expiry 18 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk and1.`,

`Kasus:
Seorang admin diminta menyiapkan server CI/CD. Dalam proyek ini dibutuhkan:
‚óè Direktori utama CICD yang berisi 3 subdirektori: jobs, secrets, artifacts.
‚óè Tiga grup: Builders, SecretsTeam, Release.
‚óè Enam pengguna: build1, build2, sec1, sec2, rel1, rel2.
‚óè Di dalam jobs dibuat file (pipeline.yml, deploy.sh, last.log):
a. pipeline.yml ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. deploy.sh ‚Üí pemilik: read, write, execute; grup: read, execute; selainnya: read.
c. last.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu user Release (rel2) diatur expiry 22 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk rel2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk layanan monitoring. Dalam proyek ini dibutuhkan:
‚óè Direktori utama Monitor yang berisi 3 subdirektori: agents, configs, alerts.
‚óè Tiga grup: Agents, Ops, Viewers.
‚óè Enam pengguna: agent1, agent2, ops1, ops2, view1, view2.
‚óè Di dalam configs dibuat file (agent.conf, thresholds.txt, errors.log):
a. agent.conf ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. thresholds.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. errors.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu user Agents (agent2) expiry 12 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk agent2.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori untuk proyek IoT. Dalam proyek ini dibutuhkan:
‚óè Direktori utama IoTNet yang berisi 3 subdirektori: devices, firmware, telemetry.
‚óè Tiga grup: DeviceTeam, FirmwareTeam, DataTeam.
‚óè Enam pengguna: deva1, deva2, firm1, firm2, data1, data2.
‚óè Di devices dibuat file (sensor.py, calibrate.sh, output.log):
a. sensor.py ‚Üí pemilik: read, write, execute; grup: read, execute; selainnya: tidak ada akses.
b. calibrate.sh ‚Üí pemilik: read, write, execute; grup: read; selainnya: tidak ada akses.
c. output.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu user FirmwareTeam (firm1) expiry 16 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk firm1.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk proyek keamanan jaringan. Dalam proyek ini dibutuhkan:
‚óè Direktori utama NetSec yang berisi 3 subdirektori: captures, tools, reports.
‚óè Tiga grup: RedTeam, BlueTeam, Audit.
‚óè Enam pengguna: red1, red2, blue1, blue2, audit1, audit2.
‚óè Di captures dibuat file (sniff.pcap, summary.txt, notes.log):
a. sniff.pcap ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. summary.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. notes.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu RedTeam (red2) expiry 10 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk red2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk proyek CAD desain. Dalam proyek ini dibutuhkan:
‚óè Direktori utama CADLab yang berisi 3 subdirektori: models, renders, assets.
‚óè Tiga grup: Designers, Renders, AssetMgr.
‚óè Enam pengguna: des1, des2, ren1, ren2, asset1, asset2.
‚óè Di models dibuat file (chair.obj, table.obj, readme.md):
a. chair.obj ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. table.obj ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. readme.md ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu Designers (des1) expiry 24 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk des1.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk layanan email internal. Dalam proyek ini dibutuhkan:
‚óè Direktori utama MailSrv yang berisi 3 subdirektori: inbox, config, archive.
‚óè Tiga grup: MailAdmin, Support, Auditor.
‚óè Enam pengguna: mail1, mail2, sup1, sup2, aud1, aud2.
‚óè Di inbox dibuat file (welcome.txt, bounce.log, forward.sh):
a. welcome.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. bounce.log ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. forward.sh ‚Üí pemilik: read, write, execute; grup: read, execute; selainnya: read.
‚óè Salah satu MailAdmin (mail2) expiry 15 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk mail2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk tim dokumentasi. Dalam proyek ini dibutuhkan:
‚óè Direktori utama Docs yang berisi 3 subdirektori: drafts, final, assets.
‚óè Tiga grup: Writers, Editors, Publish.
‚óè Enam pengguna: w1, w2, ed1, ed2, pub1, pub2.
‚óè Di drafts dibuat file (chapter1.md, notes.txt, edit.log):
a. chapter1.md ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. notes.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. edit.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu Editors (ed2) expiry 11 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk ed2.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori kerja untuk sistem arsip digital. Dalam proyek ini dibutuhkan:
‚óè Direktori utama DigiArchive yang berisi 3 subdirektori: upload, storage, backup.
‚óè Tiga grup kolaborasi: Uploader, Archivist, BackupTeam.
‚óè Enam pengguna: up1, up2, arch1, arch2, bup1, bup2.
‚óè Di storage dibuat file (doc1.pdf, doc2.pdf, index.txt):
a. doc1.pdf ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. doc2.pdf ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. index.txt ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu BackupTeam (bup1) expiry 25 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk bup1.`,

`Kasus:
Seorang admin diminta menyiapkan direktori kerja untuk laboratorium robotika. Dalam proyek ini dibutuhkan:
‚óè Direktori utama RoboLab yang berisi 3 subdirektori: scripts, test, output.
‚óè Tiga grup kolaborasi: DevTeam, TestTeam, Hardware.
‚óè Enam pengguna: rdev1, rdev2, rtest1, rtest2, rhw1, rhw2.
‚óè Di scripts dibuat file (control.py, sensor.cfg, log.txt):
a. control.py ‚Üí pemilik: read, write, execute; grup: read; selainnya: tidak ada akses.
b. sensor.cfg ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. log.txt ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu TestTeam (rtest2) expiry 10 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk rtest2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk sistem e-learning. Dalam proyek ini dibutuhkan:
‚óè Direktori utama ElearnSys yang berisi 3 subdirektori: lectures, assignments, grading.
‚óè Tiga grup: Teacher, Student, Assessor.
‚óè Enam pengguna: t1, t2, s1, s2, a1, a2.
‚óè Di assignments dibuat file (week1.pdf, task1.docx, grade.txt):
a. week1.pdf ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. task1.docx ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. grade.txt ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu Assessor (a2) expiry 10 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk a2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori kerja untuk platform e-commerce kecil. Dalam proyek ini dibutuhkan:
‚óè Direktori utama ShopSys yang berisi 3 subdirektori: frontend, backend, payment.
‚óè Tiga grup: Dev, Ops, Finance.
‚óè Enam pengguna: shopdev1, shopdev2, shopops1, shopops2, fin1, fin2.
‚óè Di backend dibuat file (app.py, config.ini, payments.log):
a. app.py ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. config.ini ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. payments.log ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu Finance (fin1) expiry 18 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk fin1.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori untuk pusat riset iklim. Dalam proyek ini dibutuhkan:
‚óè Direktori utama ClimateLab yang berisi 3 subdirektori: data, models, results.
‚óè Tiga grup: Analyst, Researcher, Report.
‚óè Enam pengguna: c_anal1, c_anal2, c_res1, c_res2, c_rep1, c_rep2.
‚óè Di data dibuat file (temp.csv, rain.csv, summary.txt):
a. temp.csv ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. rain.csv ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. summary.txt ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu Researcher (c_res1) expiry 28 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk c_res1.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk sistem logistik. Dalam proyek ini dibutuhkan:
‚óè Direktori utama LogiSys yang berisi 3 subdirektori: orders, delivery, report.
‚óè Tiga grup: OrderTeam, DeliveryTeam, ReportTeam.
‚óè Enam pengguna: ord1, ord2, del1, del2, r1, r2.
‚óè Di delivery dibuat file (track.csv, vehicle.log, summary.txt):
a. track.csv ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. vehicle.log ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. summary.txt ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu DeliveryTeam (del1) expiry 16 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk del1.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori kerja untuk server rekam medis rumah sakit. Dalam proyek ini dibutuhkan:
‚óè Direktori utama HosData yang berisi 3 subdirektori: patients, doctors, finance.
‚óè Tiga grup: MedTeam, DocTeam, FinTeam.
‚óè Enam pengguna: med1, med2, doc1, doc2, fin1, fin2.
‚óè Di patients/doctors/finance dibuat file (list.txt, schedule.txt, salary.csv):
a. list.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. schedule.txt ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. salary.csv ‚Üí pemilik: read, write; grup & lain: tidak ada akses.
‚óè Salah satu FinTeam (fin2) expiry 18 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk fin2.`,

`Kasus:
Seorang admin diminta menyiapkan direktori untuk pengembangan game. Dalam proyek ini dibutuhkan:
‚óè Direktori utama GameBuild yang berisi 3 subdirektori: source, assets, build.
‚óè Tiga grup: Coder, Artist, Builder.
‚óè Enam pengguna: gcode1, gcode2, gart1, gart2, gbuild1, gbuild2.
‚óè Di subdirektori dibuat file (main.cpp, character.png, release.exe):
a. main.cpp ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. character.png ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
c. release.exe ‚Üí pemilik: read, write, execute; grup: execute; selainnya: tidak ada akses.
‚óè Salah satu Builder (gbuild1) expiry 20 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk gbuild1.`,

`Kasus:
Seorang administrator diminta menyiapkan direktori untuk server editing media. Dalam proyek ini dibutuhkan:
‚óè Direktori utama MediaStudio yang berisi 3 subdirektori: raw, edit, export.
‚óè Tiga grup: Editor, Renderer, Producer.
‚óè Enam pengguna: ed1, ed2, ren1, ren2, prod1, prod2.
‚óè Di raw/edit/export dibuat file (footage.mp4, timeline.edt, final.mp4):
a. footage.mp4 ‚Üí pemilik: read, write; grup: read; selainnya: tidak ada akses.
b. timeline.edt ‚Üí pemilik: read, write; grup: read, write; selainnya: tidak ada akses.
c. final.mp4 ‚Üí pemilik: read; grup: read; selainnya: read.
‚óè Salah satu Editor (ed1) expiry 25 hari.
‚óè Verifikasi: tampilkan struktur direktori dan izin file, serta periksa masa berlaku password untuk ed1.`
];


    // render grid
    const grid = document.getElementById('grid');
    function renderGrid(){
      grid.innerHTML = '';
      studyCases.forEach((raw, idx)=>{
        const id = idx+1;
        const title = `Study Case #${id}`;
        const c = document.createElement('article');
        c.className = 'card';
        c.id = 'sc-'+id;
        c.innerHTML = `
          <div>
            <div style="display:flex;align-items:center;justify-content:space-between">
              <h3>${title}</h3>
              <span class="tag">#${String(id).padStart(2,'0')}</span>
            </div>
            <p>${getPreview(raw)}</p>
          </div>
          <div class="footer">
            <small style="color:#9fbdf4">1 deskripsi</small>
            <div style="display:flex;align-items:center">
              <button class="secondary open-btn" data-id="${id}" type="button">Lihat</button>
            </div>
          </div>
        `;
        c.addEventListener('click',(e)=>{ if(e.target.closest('button')) return; selectCard(id); });
        const btn = c.querySelector('.open-btn');
        btn.addEventListener('click',(e)=>{ e.stopPropagation(); openModal(id); selectCard(id); });
        grid.appendChild(c);
      });
    }

    function getPreview(text){
      const firstLine = text.split('\n').find(l=>l.trim().length>0) || '';
      return firstLine.length>120 ? firstLine.slice(0,120)+'...' : firstLine;
    }

    renderGrid();

    // selection
    let picked = null;
    const pickedLabel = document.getElementById('pickedLabel');
    function selectCard(id){
      document.querySelectorAll('.card').forEach(el=>el.classList.remove('selected'));
      const el = document.getElementById('sc-'+id);
      if(el) el.classList.add('selected');
      picked = { id, title:`Study Case #${id}`, description: studyCases[id-1] };
      pickedLabel.textContent = picked ? picked.title : 'Tidak ada';
    }

    // format raw -> HTML (preserve content exactly, convert bullets & letters to lists for display only)
    function formatRawToHTML(raw){
      const lines = raw.split('\n').map(l=>l.replace(/\r/g,''));
      let html = '';
      let inUl = false;
      let inAlpha = false;
      for(let i=0;i<lines.length;i++){
        const line = lines[i].trim();
        if(!line){
          if(inUl){ html += '</ul>'; inUl=false; }
          if(inAlpha){ html += '</ol>'; inAlpha=false; }
          continue;
        }
        if(line.startsWith('Kasus:')){
          const rest = line.substring(6).trim();
          html += `<div class="desc-par"><strong>Kasus:</strong> ${escapeHtml(rest)}</div>`;
          continue;
        }
        if(line.startsWith('‚óè')){
          if(inAlpha){ html += '</ol>'; inAlpha=false; }
          if(!inUl){ html += '<ul class="desc-ul">'; inUl=true; }
          const content = line.replace(/^‚óè\s*/,'').trim();
          html += `<li>${escapeHtml(content)}</li>`;
          continue;
        }
        if(line.match(/^[a-z]\.\s*/i)){
          if(inUl){ html += '</ul>'; inUl=false; }
          if(!inAlpha){ html += '<ol class="desc-ol-alpha">'; inAlpha=true; }
          const content = line.replace(/^[a-z]\.\s*/i,'').trim();
          html += `<li>${escapeHtml(content)}</li>`;
          continue;
        }
        if(inUl){ html += '</ul>'; inUl=false; }
        if(inAlpha){ html += '</ol>'; inAlpha=false; }
        html += `<div class="desc-par">${escapeHtml(line)}</div>`;
      }
      if(inUl) html += '</ul>';
      if(inAlpha) html += '</ol>';
      return html;
    }

    // modal handlers
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalSteps = document.getElementById('modalSteps');

    function openModal(id){
      const raw = studyCases[id-1];
      modalTitle.textContent = `Study Case #${id}`;
      modalSteps.innerHTML = formatRawToHTML(raw);
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      setTimeout(()=> document.getElementById('closeModal').focus(), 80);
    }
    function closeModalUI(){ modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); }
    document.getElementById('closeModal').addEventListener('click', ()=> closeModalUI());

    // copy modal
    function showCopyModal(text){
      const modal = document.getElementById('copyModal');
      const area = document.getElementById('copyArea');
      area.value = text;
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      setTimeout(()=> { area.focus(); area.select(); }, 80);
    }
    const closeCopyBtn = document.getElementById('closeCopy');
    if(closeCopyBtn) closeCopyBtn.addEventListener('click', ()=> {
      document.getElementById('copyModal').style.display='none';
      document.getElementById('copyModal').setAttribute('aria-hidden','true');
    });
    const selectAllBtn = document.getElementById('selectAll');
    if(selectAllBtn) selectAllBtn.addEventListener('click', ()=>{ const a=document.getElementById('copyArea'); if(a) a.select(); });

    async function safeCopy(text){
      try {
        if(navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (err) {}
      showCopyModal(text);
      return false;
    }

    // NOTE: the UI originally referenced copyBtn, copyGuide, pickAgain, exportSelected.
    // Those elements are optional in the DOM. Attach handlers only if present (guard).
    const copyBtn = document.getElementById('copyBtn');
    if(copyBtn){
      copyBtn.addEventListener('click', async ()=>{
        if(!picked){ alert('Belum ada study case yang dipilih.'); return }
        const ok = await safeCopy(picked.description);
        if(ok) alert('Tersalin ke clipboard');
      });
    }

    // permission guide (shows raw list)
    const permGuide = document.getElementById('permGuide');
    const guideContent = document.getElementById('guideContent');
    const openPermGuideBtn = document.getElementById('openPermGuide');
    if(openPermGuideBtn){
      openPermGuideBtn.addEventListener('click', ()=>{
        guideContent.innerText = studyCases.join('\n\n---\n\n');
        permGuide.style.display = 'flex';
        permGuide.setAttribute('aria-hidden','false');
      });
    }
    const closeGuideBtn = document.getElementById('closeGuide');
    if(closeGuideBtn) closeGuideBtn.addEventListener('click', ()=> { permGuide.style.display='none'; permGuide.setAttribute('aria-hidden','true'); });

    const copyGuideBtn = document.getElementById('copyGuide');
    if(copyGuideBtn) copyGuideBtn.addEventListener('click', async ()=>{
      const all = studyCases.join('\n\n---\n\n');
      const ok = await safeCopy(all);
      if(ok) alert('Semua study case tersalin');
    });

    // GACHA + overlay + timer logic
    const gachaBtn = document.getElementById('gachaBtn');
    const gachaTimerLabel = document.getElementById('gachaTimer');
    let countdownInterval = null;
    let countdownEndsAt = null;
    let countdownRemaining = 0;

    function getLastGachaData(){ const v = localStorage.getItem(STORAGE_KEY); try{ return v ? JSON.parse(v) : null; }catch(e){ return null; } }
    function setLastGachaData(obj){ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }
    function clearLastGachaData(){ localStorage.removeItem(STORAGE_KEY); }
    function msRemainingFrom(timestamp){ const cooldownMs = GACHA_COOLDOWN_MINUTES * 60 * 1000; const elapsed = Date.now() - timestamp; return Math.max(0, cooldownMs - elapsed); }
    function formatMsAsMMSS(ms){ const totalSec = Math.ceil(ms/1000); const minutes = Math.floor(totalSec / 60); const seconds = totalSec % 60; return `${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`; }

    function startCountdown(ms){
      if(countdownInterval) clearInterval(countdownInterval);
      countdownRemaining = ms;
      countdownEndsAt = Date.now() + ms;
      updateAllDisplays(countdownRemaining);
      if(gachaBtn){ gachaBtn.disabled = true; gachaBtn.setAttribute('aria-disabled','true'); }

      countdownInterval = setInterval(()=>{
        const rem = Math.max(0, countdownEndsAt - Date.now());
        countdownRemaining = rem;
        if(rem <= 0){
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRemaining = 0;
          countdownEndsAt = null;
          if(gachaTimerLabel) gachaTimerLabel.textContent = '';
          if(gachaBtn){ gachaBtn.disabled = false; gachaBtn.removeAttribute('aria-disabled'); }
          const overlayTimerBig = document.getElementById('overlayTimerBig');
          const overlayProgress = document.getElementById('overlayProgress');
          if(overlayTimerBig) overlayTimerBig.textContent = '--:--';
          if(overlayProgress) overlayProgress.style.width = '0%';
          clearLastGachaData();
        } else {
          updateAllDisplays(rem);
        }
      }, 250);
    }

    function updateAllDisplays(ms){
      const txt = formatMsAsMMSS(ms);
      if(gachaTimerLabel) gachaTimerLabel.textContent = txt;
      const totalMs = GACHA_COOLDOWN_MINUTES * 60 * 1000;
      const pct = Math.max(0, Math.min(100, ((totalMs - ms) / totalMs) * 100));
      const overlayTimerBig = document.getElementById('overlayTimerBig');
      const overlayProgress = document.getElementById('overlayProgress');
      if(overlayTimerBig && overlayProgress){
        overlayTimerBig.textContent = txt;
        overlayProgress.style.width = pct + '%';
      }
    }

    // overlay elements
    const postOverlay = document.getElementById('postGachaOverlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlaySubtitle = document.getElementById('overlaySubtitle');
    const overlaySummary = document.getElementById('overlaySummary');
    const overlayPermsShort = document.getElementById('overlayPermsShort');
    const startGachaLockBtn = document.getElementById('startGachaLock');
    const hideOverlayBtn = document.getElementById('hideOverlay');
    const stopTimerBtn = document.getElementById('stopTimer');
    let justPicked = null;
    
    // VARIABEL BARU UNTUK SPINNER
    const gachaSpinner = document.getElementById('gachaSpinner'); 

    if(gachaBtn){
      gachaBtn.addEventListener('click', ()=>{
        const data = getLastGachaData();
        if(data && data.ts){
          const rem = msRemainingFrom(data.ts);
          if(rem > 0){
            alert(`Sudah pernah GACHA. Coba lagi setelah ${formatMsAsMMSS(rem)}`);
            return;
          }
        }

        // 1. TAMPILKAN OVERLAY DAN MULAI ANIMASI
        // Sembunyikan semua konten hasil GACHA terlebih dahulu
        overlayTitle.textContent = '... Mencari Study Case ...';
        overlaySubtitle.textContent = 'Memutar Dadu Keberuntungan...';
        overlaySummary.innerHTML = '<div class="desc-par">Mohon tunggu sebentar.</div>';
        overlayPermsShort.innerHTML = '';
        startGachaLockBtn && (startGachaLockBtn.style.display = 'none');
        hideOverlayBtn && (hideOverlayBtn.style.display = 'none');
        
        gachaSpinner.style.display = 'block'; // Tampilkan spinner
        gachaSpinner.classList.add('is-spinning'); // Mulai putaran
        gachaBtn.disabled = true; // Nonaktifkan tombol utama
        gachaBtn.textContent = '‚è≥ ROLLING...';
        
        postOverlay.style.display = 'flex';
        postOverlay.setAttribute('aria-hidden','false');


        // 2. TUNDA EKSEKUSI (DELAY)
        setTimeout(() => {
            
            // 3. HENTIKAN ANIMASI DAN TAMPILKAN HASIL
            gachaSpinner.style.display = 'none'; // Sembunyikan spinner
            gachaSpinner.classList.remove('is-spinning'); // Hentikan putaran
            gachaBtn.disabled = false;
            gachaBtn.textContent = 'üé≤ GACHA';
            
            // --- LOGIKA INTI GACHA ---
            const randomIdx = Math.floor(Math.random()*studyCases.length);
            const random = studyCases[randomIdx];
            justPicked = { id: randomIdx+1, desc: random };
            overlayTitle.textContent = `Study Case #${justPicked.id}`;
            overlaySubtitle.textContent = 'Ringkasan study case yang kamu dapatkan.';
            overlaySummary.innerHTML = formatRawToHTML(justPicked.desc);
            // extract any "Salah satu user ..." lines to highlight expiry info
            const expiryLines = justPicked.desc.split('\n').filter(l=>/masa berlaku password|masa berlaku kata sandi|expiry|masa berlaku password-nya/i.test(l));
            overlayPermsShort.innerHTML = expiryLines.length ? expiryLines.map(l=>`<div style="padding:6px 4px;border-bottom:1px dashed rgba(255,255,255,0.02)">${escapeHtml(l.trim())}</div>`).join('') : '<div class="desc-par">Tidak ada catatan expiry khusus.</div>';
            startGachaLockBtn && (startGachaLockBtn.style.display = 'block');
            hideOverlayBtn && (hideOverlayBtn.style.display = 'inline-block');
            stopTimerBtn && (stopTimerBtn.style.display = 'none');
            const overlayTimerBig = document.getElementById('overlayTimerBig');
            const overlayProgress = document.getElementById('overlayProgress');
            if(overlayTimerBig) overlayTimerBig.textContent = '--:--';
            if(overlayProgress) overlayProgress.style.width = '0%';
            
            // Fokuskan tombol MULAI setelah hasil muncul
            setTimeout(()=> startGachaLockBtn && startGachaLockBtn.focus(), 80);
            // --- LOGIKA INTI GACHA SELESAI ---
            
        }, GACHA_ANIMATION_DURATION_MS); // Menggunakan durasi 2000ms (2 detik)
      });
    }

    if(startGachaLockBtn){
      startGachaLockBtn.addEventListener('click', ()=>{
        if(!justPicked) return;
        selectCard(justPicked.id);
        const now = Date.now();
        setLastGachaData({ ts: now, id: justPicked.id });
        const cooldownMs = GACHA_COOLDOWN_MINUTES * 60 * 1000;
        startCountdown(cooldownMs);
        startGachaLockBtn.style.display = 'none';
        stopTimerBtn && (stopTimerBtn.style.display = 'inline-block');
        justPicked = null;
      });
    }

    if(hideOverlayBtn){
      hideOverlayBtn.addEventListener('click', ()=>{
        postOverlay.style.display = 'none';
        postOverlay.setAttribute('aria-hidden','true');
      });
    }

    if(stopTimerBtn){
      stopTimerBtn.addEventListener('click', ()=>{
        if(!confirm('Hentikan timer? Ini akan membatalkan lock GACHA.')) return;
        if(countdownInterval) clearInterval(countdownInterval);
        countdownInterval = null;
        countdownRemaining = 0;
        countdownEndsAt = null;
        if(gachaTimerLabel) gachaTimerLabel.textContent = '';
        if(gachaBtn){ gachaBtn.disabled = false; gachaBtn.removeAttribute('aria-disabled'); }
        const overlayTimerBig = document.getElementById('overlayTimerBig');
        const overlayProgress = document.getElementById('overlayProgress');
        if(overlayTimerBig) overlayTimerBig.textContent = '--:--';
        if(overlayProgress) overlayProgress.style.width = '0%';
        startGachaLockBtn && (startGachaLockBtn.style.display = 'block');
        stopTimerBtn.style.display = 'none';
        clearLastGachaData();
      });
    }

    postOverlay.addEventListener('click', (e)=>{
      if(e.target === postOverlay){
        postOverlay.style.display = 'none';
        postOverlay.setAttribute('aria-hidden','true');
      }
    });

    // optional pickAgain/exportSelected handlers: guard if present
    const pickAgainBtn = document.getElementById('pickAgain');
    if(pickAgainBtn){
      pickAgainBtn.addEventListener('click', ()=>{
        if(!picked){
          gachaBtn && gachaBtn.click();
          return;
        }
        let poolIdxs = studyCases.map((_,i)=>i);
        const currentIdx = picked.id - 1;
        poolIdxs = poolIdxs.filter(i=>i !== currentIdx);
        if(poolIdxs.length === 0) poolIdxs = studyCases.map((_,i)=>i);
        const random = poolIdxs[Math.floor(Math.random()*poolIdxs.length)];
        selectCard(random+1);
        openModal(random+1);
      });
    }

    const exportSelectedBtn = document.getElementById('exportSelected');
    if(exportSelectedBtn){
      exportSelectedBtn.addEventListener('click', ()=>{
        if(!picked){ alert('Belum ada study case terpilih.'); return }
        const blob = new Blob([JSON.stringify({ id:picked.id, raw:picked.description }, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `studycase-${picked.id}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
    }

    // backdrop close and ESC
    document.getElementById('modal').addEventListener('click', (e)=>{ if(e.target===document.getElementById('modal')) closeModalUI() });
    document.getElementById('permGuide').addEventListener('click', (e)=>{ if(e.target===document.getElementById('permGuide')) { permGuide.style.display='none'; permGuide.setAttribute('aria-hidden','true'); } });
    document.getElementById('copyModal').addEventListener('click', (e)=>{ if(e.target===document.getElementById('copyModal')) { document.getElementById('copyModal').style.display='none'; document.getElementById('copyModal').setAttribute('aria-hidden','true'); } });

    document.addEventListener('keydown',(e)=>{
      if(e.key === 'Escape'){
        if(document.getElementById('modal').style.display === 'flex') closeModalUI();
        if(document.getElementById('permGuide').style.display === 'flex'){ permGuide.style.display='none'; permGuide.setAttribute('aria-hidden','true'); }
        if(document.getElementById('copyModal').style.display === 'flex'){ document.getElementById('copyModal').style.display='none'; document.getElementById('copyModal').setAttribute('aria-hidden','true'); }
        if(document.getElementById('postGachaOverlay').style.display === 'flex'){ postOverlay.style.display='none'; postOverlay.setAttribute('aria-hidden','true'); justPicked = null; }
      }
    });

    // small utils
    function escapeHtml(s){
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    // on load: restore lock if present
    (function(){ 
      const data = getLastGachaData();
      if(!data || !data.ts) return;
      const rem = msRemainingFrom(data.ts);
      if(rem > 0) startCountdown(rem);
      else clearLastGachaData();
    })();

  </script>
</body>
</html>